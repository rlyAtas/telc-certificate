<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>telc ‚Äì Status der Anfrage</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="wrap">
    <div class="card card--status">
      <h1 class="status-page__title">Status Ihrer Anfrage</h1>

      <%
        const statusMap = {
          ACTIVE: {
            tone: 'active',
            badge: 'Aktiv',
            icon: 'üïí',
            message: 'Die √úberpr√ºfung des Zertifikats l√§uft.',
          },
          CERTIFICATE_FOUND: {
            tone: 'success',
            badge: 'Gefunden',
            icon: '‚úÖ',
            message: 'Das Zertifikat wurde gefunden.',
          },
          CHECKING_EXPIRED: {
            tone: 'warning',
            badge: 'Abgeschlossen',
            icon: '‚ÑπÔ∏è',
            message: 'Die √úberpr√ºfung ist abgeschlossen. Im Pr√ºfzeitraum wurde kein Zertifikat gefunden.',
          },
          CERTIFICATE_FAILED: {
            tone: 'error',
            badge: 'Nicht gefunden',
            icon: '‚ùå',
            message: 'Das Zertifikat konnte innerhalb des Pr√ºfzeitraums nicht gefunden werden.',
          },
        };

        const statusView = statusMap[status] ?? {
          tone: 'neutral',
          badge: 'Unbekannt',
          icon: '‚ÑπÔ∏è',
          message: 'Der aktuelle Status konnte nicht eindeutig bestimmt werden.',
        };

        const dateFormatter = new Intl.DateTimeFormat('de-DE', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
        });

        const dateTimeFormatter = new Intl.DateTimeFormat('de-DE', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
        });

        const formatDate = (value) => dateFormatter.format(new Date(value));
        const formatDateTime = (value) => dateTimeFormatter.format(new Date(value));

        const lastCheckValue = lastCheckedAt ? formatDateTime(lastCheckedAt) : 'Noch nicht gepr√ºft';
        const nextCheckValue = nextRunAt ? formatDateTime(nextRunAt) : 'Wird geplant';
        const shouldShowNextCheck = status === 'ACTIVE';
      %>

      <section class="status-banner status-banner--<%= statusView.tone %>">
        <span class="status-chip status-chip--<%= statusView.tone %>">
          <%= statusView.icon %> <%= statusView.badge %>
        </span>
        <p class="status-banner__message"><%= statusView.message %></p>
        <% if (certificateUrl) { %>
          <a class="status-cta" href="<%= certificateUrl %>">Zertifikat √∂ffnen</a>
        <% } %>
      </section>

      <div class="card subcard status-details">
        <section class="status-details__section">
          <p class="status-details__section-title">Anfrage</p>

          <div class="status-kv">
            <span class="status-kv__label">Pr√ºfungsdatum</span>
            <span class="status-kv__value"><%= formatDate(examDate) %></span>
          </div>

          <% if (finishedAt) { %>
            <div class="status-kv">
              <span class="status-kv__label">Abgeschlossen am</span>
              <span class="status-kv__value"><%= formatDate(finishedAt) %></span>
            </div>
          <% } %>
        </section>

        <section class="status-details__section status-details__section--checks">
          <p class="status-details__section-title">√úberpr√ºfung</p>

          <% if (shouldShowNextCheck) { %>
            <p class="status-details__hint">Die Suche nach dem Zertifikat erfolgt alle 4 Stunden.</p>
          <% } %>

          <div class="status-kv">
            <span class="status-kv__label">Letzte √úberpr√ºfung</span>
            <span class="status-kv__value status-kv__value--mono"><%= lastCheckValue %></span>
          </div>

          <% if (shouldShowNextCheck) { %>
            <div class="status-kv">
              <span class="status-kv__label">N√§chste √úberpr√ºfung</span>
              <span class="status-kv__value status-kv__value--mono"><%= nextCheckValue %></span>
            </div>
          <% } %>
        </section>
      </div>
    </div>
  </div>
</body>
</html>
